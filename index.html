<!DOCTYPE html>
<html>
    <head>
        <link rel="manifest" href="manifest.webmanifest">
        <title>Brunch PWA</title>
        <script>
                window.addEventListener('online', handleConnection);
                window.addEventListener('offline', handleConnection);
                
            function isReachable(url) {
                  /**
                   * Note: fetch() still "succeeds" for 404s on subdirectories,
                   * which is ok when only testing for domain reachability.
                   *
                   * Example:
                   *   https://google.com/noexist does not throw
                   *   https://noexist.com/noexist does throw
                   */
                  return fetch(url, { method: 'HEAD', mode: 'no-cors' })
                    .then(function(resp) {
                      return resp && (resp.ok || resp.type === 'opaque');
                    })
                    .catch(function(err) {
                      console.warn('[conn test failure]:', err);
                    });
                }
            
            function handleConnection() {        
            if (navigator.onLine) {
                isReachable("https://sebanc.github.io/brunch-pwa-dev").then(function(online) {
                          if (online) {
                            // handle online status
                            console.log('online');
                            window.location.href = "html/brunch.html";
                          } else {
                            console.log('no connectivity');
                            document.body.innerHTML = '<div style="direction: ltr; position: fixed; top: 0; z-index: 999999; display: block; width: 100%; height: 100%; background: #33266e"><p style="position: relative; top: 40%; display: block; font-size: 32px; font-weight: bold; color: #fff; margin: 0 auto; text-align: center">Brunch PWA needs an internet connection.</p></div>';
                          }
                        });
                      } else {
                        // handle offline status
                        console.log('offline');
                        document.body.innerHTML = '<div style="direction: ltr; position: fixed; top: 0; z-index: 999999; display: block; width: 100%; height: 100%; background: #33266e"><p style="position: relative; top: 40%; display: block; font-size: 32px; font-weight: bold; color: #fff; margin: 0 auto; text-align: center">Brunch PWA needs an internet connection.</p></div>';
                      }
                    }
        </script>
    </head>
</html>
